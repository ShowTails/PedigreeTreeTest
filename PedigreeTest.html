<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

   <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  
  <title>4-Generation Rabbit Pedigree</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: white;
  }

 #pedigree-container {
  width: 100vw;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  background: white;
}


svg {
  display: block;
  width: 100% !important;
  height: 100% !important;
  /* UPDATED: Removed restrictive max-height/max-width to prevent viewBox shrinkage */
  transform: none !important;
  margin: 0.1in auto 0 !important;
  background: white !important;
  page-break-inside: avoid !important;
    touch-action: none !important;       
  -ms-touch-action: none !important;   
}


  .box {
    width: 320px;
    height: 125px;
    rx: 10;
    ry: 10;
    stroke: black;
    stroke-width: 1.5;
    fill: white;
  }

  .male { fill: #cce5ff; }
  .female { fill: #f8d7da; }

  text {
    font-size: 14px;
    font-family: Arial, sans-serif;
  }

  .name { font-weight: bold; font-size: 16px; }
  .title { font-weight: bold; font-size: 20px; }

  @page {
    size: 11in 8.5in landscape;
    margin: 0;
  }

  @media print {
    html, body {
      width: 11in;
      height: 8.5in;
      margin: 0;
      padding: 0;
      overflow: visible;
      background: white;
    }

    /* Center the pedigree on the page */
    #pedigree-container {
      width: 11in;
      height: 8.5in;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0;
      padding: 0;
      background: white;
      overflow: hidden; /* Prevent second page generation */
    }

    svg {
      width: 10.8in !important;
      height: 8.3in !important;
      transform: none !important;
      background: white !important;
      margin: 0 auto !important;
    }
    
    /* ADDED FIX: Force SVG content to display without unintended transforms in print */
    #pedigree-container svg {
      transform: scale(1) translate(0, 0) !important;
      position: absolute !important; 
      top: 0;
      left: 0;
    }
    
    #pedigree-container > * {
      transform: none !important;
    }

    #logo {
      outline: 2px dashed red;
    }


    #print-btn,
    #reset-view-btn {
      display: none !important;
    }
  }

</style>


  <script>
function getParam(name) {
  const params = new URLSearchParams(window.location.search);
  const value = params.get(name) || '';
  // Decode URL entities and escape HTML
  return value
    .replaceAll('+', ' ')
    .replace(/%26/g, '&')
    .replace(/%27/g, "'")
    .replace(/%20/g, ' ')
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}
</script>
</head>
<body>
  
  <div id="pedigree-container">
<svg id="pedigree-svg" viewBox="-80 -120 1750 1450" preserveAspectRatio="xMidYMid meet">

<g id="header" transform="translate(100, -40)">
  <image
    id="logo"
    x="0"
    y="-60"
    width="140"
    height="140"
    preserveAspectRatio="xMidYMid meet"
  />

  <g transform="translate(160, -10)">
    <text x="0" y="0" text-anchor="start" class="title" data-field="rabbitry"></text>
    <text x="0" y="20" text-anchor="start" class="name" data-field="street"></text>
    <text x="0" y="40" text-anchor="start" class="name" data-chain="city,state,zip"></text>
    <text x="0" y="60" text-anchor="start" class="name" data-field="phone"></text>
    <text x="0" y="80" text-anchor="start" class="name" data-field="email"></text>
    <text x="0" y="110" text-anchor="start" class="name">Breed:</text>
    <text x="60" y="110" text-anchor="start" class="name" data-field="breed"></text>
  </g>
</g>



    <g transform="translate(20,740)">
      <text class="name" x="40" y="200">I hereby certify that this pedigree is correct to the best of my knowledge.</text>
      <line x1="40" y1="260" x2="350" y2="260" stroke="#000" stroke-width="1" />
      <text class="name" x="40" y="280">Breeder's Signature</text>
    </g>
  <image
  id="signature"
  x="40"
  y="950"
  width="220"
  height="80"
  preserveAspectRatio="xMidYMid meet"
/>

  <rect x="100" y="380" width="220" height="90" class="box"/>
  <text x="110" y="400" text-anchor="left" class="name" data-chain="crabbitry,name"></text>
  <text x="110" y="420" text-anchor="left" class="label">Color:</text>
  <text x="150" y="420" text-anchor="left" data-field="color">  </text>
  <text x="110" y="440" text-anchor="left" class="label">Ear#:</text>
  <text x="150" y="440" text-anchor="left" data-field="ear number"></text>
  <text x="270" y="440" text-anchor="left" class="label">Weight:</text>
  <text x="320" y="440" text-anchor="left" data-field="weight"></text>
  <text x="110" y="460" text-anchor="left" class="label">Sex:</text>
  <text x="150" y="460" text-anchor="left" data-field="sex"></text>
  <text x="270" y="460" text-anchor="left" class="label">Legs:</text>
  <text x="310" y="460" text-anchor="left" data-field="legs"> </text>
  <text x="110" y="480" text-anchor="left" class="label">Reg#:</text>
  <text x="150" y="480" text-anchor="left" data-field="reg"></text>
  <text x="270" y="480" text-anchor="left" class="label">GC#:</text>
  <text x="310" y="480" text-anchor="left" data-field="gc"></text>
  <text x="110" y="500" text-anchor="left" class="label">DOB:</text>
  <text x="150" y="500" text-anchor="left" data-field="dob"></text>
  

  <line x1="420" y1="440" x2="450" y2="165" stroke="black"/>
  <line x1="420" y1="440" x2="450" y2="715" stroke="black"/>

  <rect x="450" y="100" width="220" height="90" class="box male" data-slot="sire"/>
  <text x="460" y="120" text-anchor="left" class="name" data-chain="srabbitry,sire"></text>
  <text x="460" y="140" text-anchor="left" class="label">Color:</text>
  <text x="500" y="140" text-anchor="left" data-field="scolor">  </text>
  <text x="460" y="160" text-anchor="left" class="label">Ear#:</text>
  <text x="500" y="160" text-anchor="left" data-field="sear"></text>
  <text x="620" y="160" text-anchor="left" class="label">Weight:</text>
  <text x="680" y="160" text-anchor="left" data-field="sweight"></text>
  <text x="460" y="180" text-anchor="left" class="label">Sex:</text>
  <text x="500" y="180" text-anchor="left" data-field="ssex"></text>
  <text x="620" y="180" text-anchor="left" class="label">Legs:</text>
  <text x="680" y="180" text-anchor="left" data-field="slegs"> </text>
  <text x="460" y="200" text-anchor="left" class="label">Reg#:</text>
  <text x="500" y="200" text-anchor="left" data-field="sreg"></text>
  <text x="620" y="200" text-anchor="left" class="label">GC#:</text>
  <text x="680" y="200" text-anchor="left" data-field="sgc"></text>
  <text x="460" y="220" text-anchor="left" class="label">DOB:</text>
  <text x="500" y="220" text-anchor="left" data-field="sdob"></text>
 

  
  <line x1="770" y1="165" x2="800" y2="35" stroke="black"/>
  <line x1="770" y1="165" x2="800" y2="300" stroke="black"/>

  <rect x="450" y="650" width="200" height="90" class="box female"/>
  <text x="460" y="670" text-anchor="left" class="name" data-chain="drabbitry,dam"></text>
  <text x="460" y="690" text-anchor="left" class="label">Color:</text>
  <text x="500" y="690" text-anchor="left" data-field="dcolor">  </text>
  <text x="460" y="710" text-anchor="left" class="label">Ear#:</text>
  <text x="500" y="710" text-anchor="left" data-field="dear">Sex:</text>
  <text x="620" y="710" text-anchor="left" class="label">Weight:</text>
  <text x="680" y="710" text-anchor="left" data-field="dweight"></text>
  <text x="460" y="730" text-anchor="left" class="label">Sex:</text>
  <text x="500" y="730" text-anchor="left" data-field="dsex"></text>
  <text x="620" y="730" text-anchor="left" class="label">Legs:</text>
  <text x="680" y="730" text-anchor="left" data-field="dlegs"> </text>
  <text x="460" y="750" text-anchor="left" class="label">Reg#:</text>
  <text x="500" y="750" text-anchor="left" data-field="dreg"></text>
  <text x="620" y="750" text-anchor="left" class="label">GC#:</text>
  <text x="680" y="750" text-anchor="left" data-field="dgc"></text>
  <text x="460" y="770" text-anchor="left" class="label">DOB:</text>
  <text x="500" y="770" text-anchor="left" data-field="ddob"></text>



  <line x1="770" y1="715" x2="800" y2="580" stroke="black"/>
  <line x1="770" y1="715" x2="800" y2="850" stroke="black"/>

  <rect x="800" y="-35" width="200" height="90" class="box male"/>
  <text x="810" y="-15" text-anchor="left" class="name" data-chain="ssrabbitry,ssire"></text>
  <text x="810" y="5" text-anchor="left" class="label">Color:</text>
  <text x="850" y="5" text-anchor="left" data-field="sscolor">  </text>
  <text x="810" y="25" text-anchor="left" class="label">Ear#:</text>
  <text x="850" y="25" text-anchor="left" data-field="ssear"></text>
  <text x="980" y="25" text-anchor="left" class="label">Weight:</text>
  <text x="1030" y="25" text-anchor="left" data-field="ssweight"></text>
  <text x="810" y="45" text-anchor="left" class="label">Sex:</text>
  <text x="850" y="45" text-anchor="left" data-field="sssex"></text>
  <text x="980" y="45" text-anchor="left" class="label">Legs:</text>
  <text x="1030" y="45" text-anchor="left" data-field="sslegs"> </text>
  <text x="810" y="65" text-anchor="left" class="label">Reg#:</text>
  <text x="850" y="65" text-anchor="left" data-field="ssreg"></text>
  <text x="980" y="65" text-anchor="left" class="label">GC#:</text>
  <text x="1030" y="65" text-anchor="left" data-field="ssgc"></text>
  <text x="810" y="85" text-anchor="left" class="label">DOB:</text>
  <text x="850" y="85" text-anchor="left" data-field="ssdob"></text>

  
  <line x1="1120" y1="35" x2="1150" y2="-35" stroke="black"/>
  <line x1="1120" y1="35" x2="1150" y2="100" stroke="black"/>
  
  <rect x="800" y="235" width="200" height="90" class="box female"/>
  <text x="810" y="255" text-anchor="left" class="name" data-chain="sdrabbitry,sdam"></text>
  <text x="810" y="275" text-anchor="left" class="label">Color:</text>
  <text x="850" y="275" text-anchor="left" data-field="sdcolor">  </text>
  <text x="810" y="295" text-anchor="left" class="label">Ear#:</text>
  <text x="850" y="295" text-anchor="left" data-field="sdear"></text>
  <text x="980" y="295" text-anchor="left" class="label">Weight:</text>
  <text x="1030" y="295" text-anchor="left" data-field="sdweight"></text>
  <text x="810" y="315" text-anchor="left" class="label">Sex:</text>
  <text x="850" y="315" text-anchor="left" data-field="sdsex"></text>
  <text x="980" y="315" text-anchor="left" class="label">Legs:</text>
  <text x="1030" y="315" text-anchor="left" data-field="sdlegs"> </text>
  <text x="810" y="335" text-anchor="left" class="label">Reg#:</text>
  <text x="850" y="335" text-anchor="left" data-field="sdreg"></text>
  <text x="980" y="335" text-anchor="left" class="label">GC#:</text>
  <text x="1030" y="335" text-anchor="left" data-field="sdgc"></text>
  <text x="810" y="355" text-anchor="left" class="label">DOB:</text>
  <text x="850" y="355" text-anchor="left" data-field="sddob"></text>
  

  <line x1="1120" y1="300" x2="1150" y2="235" stroke="black"/>
  <line x1="1120" y1="300" x2="1150" y2="370" stroke="black"/>
  
  <rect x="800" y="515" width="200" height="90" class="box male"/>
  <text x="810" y="535" text-anchor="left" class="name" data-chain="dsrabbitry,dsire"></text>
  <text x="810" y="555" text-anchor="left" class="label">Color:</text>
  <text x="850" y="555" text-anchor="left" data-field="dscolor">  </text>
  <text x="810" y="575" text-anchor="left" class="label">Ear#:</text>
  <text x="850" y="575" text-anchor="left" data-field="dsear"></text>
  <text x="980" y="575" text-anchor="left" class="label">Weight:</text>
  <text x="1030" y="575" text-anchor="left" data-field="dsweight"></text>
  <text x="810" y="595" text-anchor="left" class="label">Sex:</text>
  <text x="850" y="595" text-anchor="left" data-field="dssex"></text>
  <text x="980" y="595" text-anchor="left" class="label">Legs:</text>
  <text x="1030" y="595" text-anchor="left" data-field="dslegs"> </text>
  <text x="810" y="615" text-anchor="left" class="label">Reg#:</text>
  <text x="850" y="615" text-anchor="left" data-field="dsreg"></text>
  <text x="980" y="615" text-anchor="left" class="label">GC#:</text>
  <text x="1030" y="615" text-anchor="left" data-field="dsgc"></text>
  <text x="810" y="635" text-anchor="left" class="label">DOB:</text>
  <text x="850" y="635" text-anchor="left" data-field="dsdob"></text>
  

  <line x1="1120" y1="580" x2="1150" y2="515" stroke="black"/>
  <line x1="1120" y1="580" x2="1150" y2="650" stroke="black"/>
  
  <rect x="800" y="785" width="200" height="90" class="box female"/>
  <text x="810" y="805" text-anchor="left" class="name" data-chain="ddrabbitry,ddam"></text>
  <text x="810" y="825" text-anchor="left" class="label">Color:</text>
  <text x="850" y="825" text-anchor="left" data-field="ddcolor">  </text>
  <text x="810" y="845" text-anchor="left" class="label">Ear#:</text>
  <text x="850" y="845" text-anchor="left" data-field="ddear"></text>
  <text x="980" y="845" text-anchor="left" class="label">Weight:</text>
  <text x="1030" y="845" text-anchor="left" data-field="ddweight"></text>
  <text x="810" y="865" text-anchor="left" class="label">Sex:</text>
  <text x="850" y="865" text-anchor="left" data-field="ddsex"></text>
  <text x="980" y="865" text-anchor="left" class="label">Legs:</text>
  <text x="1030" y="865" text-anchor="left" data-field="ddlegs"> </text>
  <text x="810" y="885" text-anchor="left" class="label">Reg#:</text>
  <text x="850" y="885" text-anchor="left" data-field="ddreg"></text>
  <text x="980" y="885" text-anchor="left" class="label">GC#:</text>
  <text x="1030" y="885" text-anchor="left" data-field="ddgc"></text>
  <text x="810" y="905" text-anchor="left" class="label">DOB:</text>
  <text x="850" y="905" text-anchor="left" data-field="dddob"></text>
  
  
  <line x1="1120" y1="850" x2="1150" y2="785" stroke="black"/>
  <line x1="1120" y1="850" x2="1150" y2="920" stroke="black"/>

  <rect x="1150" y="-100" width="200" height="90" class="box male"/>
  <text x="1160" y="-80" text-anchor="left" class="name" data-chain="sssrabbitry,sssire"></text>
  <text x="1160" y="-60" text-anchor="left" class="label">Color:</text>
  <text x="1200" y="-60" text-anchor="left" data-field="ssscolor">  </text>
  <text x="1160" y="-40" text-anchor="left" class="label">Ear#:</text>
  <text x="1200" y="-40" text-anchor="left" data-field="sssear"></text>
  <text x="1330" y="-40" text-anchor="left" class="label">Weight:</text>
  <text x="1380" y="-40" text-anchor="left" data-field="sssweight"></text>
  <text x="1160" y="-20" text-anchor="left" class="label">Sex:</text>
  <text x="1200" y="-20" text-anchor="left" data-field="ssssex"></text>
  <text x="1330" y="-20" text-anchor="left" class="label">Legs:</text>
  <text x="1380" y="-20" text-anchor="left" data-field="ssslegs"> </text>
  <text x="1160" y="0" text-anchor="left" class="label">Reg#:</text>
  <text x="1200" y="0" text-anchor="left" data-field="sssreg"></text>
  <text x="1330" y="0" text-anchor="left" class="label">GC#:</text>
  <text x="1380" y="0" text-anchor="left" data-field="sssgc"></text>
  <text x="1160" y="20" text-anchor="left" class="label">DOB:</text>
  <text x="1200" y="20" text-anchor="left" data-field="sssdob"></text>
  

  <rect x="1150" y="35" width="200" height="90" class="box female"/>
  <text x="1160" y="55" text-anchor="left" class="name" data-chain="ssdrabbitry,ssdam"></text>
  <text x="1160" y="75" text-anchor="left" class="label">Color:</text>
  <text x="1200" y="75" text-anchor="left" data-field="ssdcolor">  </text>
  <text x="1160" y="95" text-anchor="left" class="label">Ear#:</text>
  <text x="1200" y="95" text-anchor="left" data-field="ssdear"></text>
  <text x="1330" y="95" text-anchor="left" class="label">Weight:</text>
  <text x="1380" y="95" text-anchor="left" data-field="ssdweight"></text>
  <text x="1160" y="115" text-anchor="left" class="label">Sex:</text>
  <text x="1200" y="115" text-anchor="left" data-field="ssdsex"></text>
  <text x="1330" y="115" text-anchor="left" class="label">Legs:</text>
  <text x="1380" y="115" text-anchor="left" data-field="ssdlegs"> </text>
  <text x="1160" y="135" text-anchor="left" class="label">Reg#:</text>
  <text x="1200" y="135" text-anchor="left" data-field="ssdreg"></text>
  <text x="1330" y="135" text-anchor="left" class="label">GC#:</text>
  <text x="1380" y="135" text-anchor="left" data-field="ssdgc"></text>
  <text x="1160" y="155" text-anchor="left" class="label">DOB:</text>
  <text x="1200" y="155" text-anchor="left" data-field="ssddob"></text>
 
  <rect x="1150" y="170" width="200" height="90" class="box male"/>
  <text x="1160" y="190" text-anchor="left" class="name" data-chain="sdsrabbitry,sdsire"></text>
  <text x="1160" y="210" text-anchor="left" class="label">Color:</text>
  <text x="1200" y="210" text-anchor="left" data-field="sdscolor">  </text>
  <text x="1160" y="230" text-anchor="left" class="label">Ear#:</text>
  <text x="1200" y="230" text-anchor="left" data-field="sdsear"></text>
  <text x="1330" y="230" text-anchor="left" class="label">Weight:</text>
  <text x="1380" y="230" text-anchor="left" data-field="sdsweight"></text>
  <text x="1160" y="250" text-anchor="left" class="label">Sex:</text>
  <text x="1200" y="250" text-anchor="left" data-field="sdssex"></text>
  <text x="1330" y="250" text-anchor="left" class="label">Legs:</text>
  <text x="1380" y="250" text-anchor="left" data-field="sdslegs"> </text>
  <text x="1160" y="270" text-anchor="left" class="label">Reg#:</text>
  <text x="1200" y="270" text-anchor="left" data-field="sdsreg"></text>
  <text x="1330" y="270" text-anchor="left" class="label">GC#:</text>
  <text x="1380" y="270" text-anchor="left" data-field="sdsgc"></text>
  <text x="1160" y="290" text-anchor="left" class="label">DOB:</text>
  <text x="1200" y="290" text-anchor="left" data-field="sdsdob"></text>


  <rect x="1150" y="305" width="200" height="90" class="box female"/>
  <text x="1160" y="325" text-anchor="left" class="name" data-chain="sddrabbitry,sddam"></text>
  <text x="1160" y="345" text-anchor="left" class="label">Color:</text>
  <text x="1200" y="345" text-anchor="left" data-field="sddcolor">  </text>
  <text x="1160" y="365" text-anchor="left" class="label">Ear#:</text>
  <text x="1200" y="365" text-anchor="left" data-field="sddear"></text>
  <text x="1330" y="365" text-anchor="left" class="label">Weight:</text>
  <text x="1380" y="365" text-anchor="left" data-field="sddweight"></text>
  <text x="1160" y="385" text-anchor="left" class="label">Sex:</text>
  <text x="1200" y="385" text-anchor="left" data-field="sddsex"></text>
  <text x="1330" y="385" text-anchor="left" class="label">Legs:</text>
  <text x="1380" y="385" text-anchor="left" data-field="sddlegs"> </text>
  <text x="1160" y="405" text-anchor="left" class="label">Reg#:</text>
  <text x="1200" y="405" text-anchor="left" data-field="sddreg"></text>
  <text x="1330" y="405" text-anchor="left" class="label">GC#:</text>
  <text x="1380" y="405" text-anchor="left" data-field="sddgc"></text>
  <text x="1160" y="425" text-anchor="left" class="label">DOB:</text>
  <text x="1200" y="425" text-anchor="left" data-field="sdddob"></text>

  
  <rect x="1150" y="450" width="200" height="90" class="box male"/>
 <text x="1160" y="470" text-anchor="left" class="name" data-chain="dssrabbitry,dssire"></text>
  <text x="1160" y="490" text-anchor="left" class="label">Color:</text>
  <text x="1200" y="490" text-anchor="left" data-field="dsscolor">  </text>
  <text x="1160" y="510" text-anchor="left" class="label">Ear#:</text>
  <text x="1200" y="510" text-anchor="left" data-field="dssear"></text>
  <text x="1330" y="510" text-anchor="left" class="label">Weight:</text>
  <text x="1380" y="510" text-anchor="left" data-field="dssweight"></text>
  <text x="1160" y="530" text-anchor="left" class="label">Sex:</text>
  <text x="1200" y="530" text-anchor="left" data-field="dsssex"></text>
  <text x="1330" y="530" text-anchor="left" class="label">Legs:</text>
  <text x="1380" y="530" text-anchor="left" data-field="dsslegs"> </text>
  <text x="1160" y="550" text-anchor="left" class="label">Reg#:</text>
  <text x="1200" y="550" text-anchor="left" data-field="dssreg"></text>
  <text x="1330" y="550" text-anchor="left" class="label">GC#:</text>
  <text x="1380" y="550" text-anchor="left" data-field="dssgc"></text>
  <text x="1160" y="570" text-anchor="left" class="label">DOB:</text>
  <text x="1200" y="570" text-anchor="left" data-field="dssdob"></text>


  <rect x="1150" y="585" width="200" height="90" class="box female"/>
  <text x="1160" y="605" text-anchor="left" class="name" data-chain="dsdrabbitry,dsdam"></text>
  <text x="1160" y="625" text-anchor="left" class="label">Color:</text>
  <text x="1200" y="625" text-anchor="left" data-field="dsdcolor">  </text>
  <text x="1160" y="645" text-anchor="left" class="label">Ear#:</text>
  <text x="1200" y="645" text-anchor="left" data-field="dsdear"></text>
  <text x="1330" y="645" text-anchor="left" class="label">Weight:</text>
  <text x="1380" y="645" text-anchor="left" data-field="dsdweight"></text>
  <text x="1160" y="665" text-anchor="left" class="label">Sex:</text>
  <text x="1200" y="665" text-anchor="left" data-field="dsdsex"></text>
  <text x="1330" y="665" text-anchor="left" class="label">Legs:</text>
  <text x="1380" y="665" text-anchor="left" data-field="dsdlegs"> </text>
  <text x="1160" y="685" text-anchor="left" class="label">Reg#:</text>
  <text x="1200" y="685" text-anchor="left" data-field="dsdreg"></text>
  <text x="1330" y="685" text-anchor="left" class="label">GC#:</text>
  <text x="1380" y="685" text-anchor="left" data-field="dsdgc"></text>
  <text x="1160" y="705" text-anchor="left" class="label">DOB:</text>
  <text x="1200" y="705" text-anchor="left" data-field="dsddob"></text>


  <rect x="1150" y="720" width="200" height="90" class="box male"/>
  <text x="1160" y="740" text-anchor="left" class="name" data-chain="ddsrabbitry,ddsire"></text>
  <text x="1160" y="760" text-anchor="left" class="label">Color:</text>
  <text x="1200" y="760" text-anchor="left" data-field="ddscolor">  </text>
  <text x="1160" y="780" text-anchor="left" class="label">Ear#:</text>
  <text x="1200" y="780" text-anchor="left" data-field="ddsear"></text>
  <text x="1330" y="780" text-anchor="left" class="label">Weight:</text>
  <text x="1380" y="780" text-anchor="left" data-field="ddsweight"></text>
  <text x="1160" y="800" text-anchor="left" class="label">Sex:</text>
  <text x="1200" y="800" text-anchor="left" data-field="ddssex"></text>
  <text x="1330" y="800" text-anchor="left" class="label">Legs:</text>
  <text x="1380" y="800" text-anchor="left" data-field="ddslegs"> </text>
  <text x="1160" y="820" text-anchor="left" class="label">Reg#:</text>
  <text x="1200" y="820" text-anchor="left" data-field="ddsreg"></text>
  <text x="1330" y="820" text-anchor="left" class="label">GC#:</text>
  <text x="1380" y="820" text-anchor="left" data-field="ddsgc"></text>
  <text x="1160" y="840" text-anchor="left" class="label">DOB:</text>
  <text x="1200" y="840" text-anchor="left" data-field="ddsdob"></text>


  <rect x="1150" y="855" width="200" height="90" class="box female"/>
  <text x="1160" y="875" text-anchor="left" class="name" data-chain="dddrabbitry,dddam"></text>
  <text x="1160" y="895" text-anchor="left" class="label">Color:</text>
  <text x="1200" y="895" text-anchor="left" data-field="dddcolor">  </text>
  <text x="1160" y="915" text-anchor="left" class="label">Ear#:</text>
  <text x="1200" y="915" text-anchor="left" data-field="dddear"></text>
  <text x="1330" y="915" text-anchor="left" class="label">Weight:</text>
  <text x="1380" y="915" text-anchor="left" data-field="dddweight"></text>
  <text x="1160" y="935" text-anchor="left" class="label">Sex:</text>
  <text x="1200" y="935" text-anchor="left" data-field="dddsex"></text>
  <text x="1330" y="935" text-anchor="left" class="label">Legs:</text>
  <text x="1380" y="935" text-anchor="left" data-field="dddlegs"> </text>
  <text x="1160" y="955" text-anchor="left" class="label">Reg#:</text>
  <text x="1200" y="955" text-anchor="left" data-field="dddreg"></text>
  <text x="1330" y="955" text-anchor="left" class="label">GC#:</text>
  <text x="1380" y="955" text-anchor="left" data-field="dddgc"></text>
  <text x="1160" y="975" text-anchor="left" class="label">DOB:</text>
  <text x="1200" y="975" text-anchor="left" data-field="ddddob"></text>

    
 
</svg>
</div>
  <button id="print-btn" style="
  position: absolute; 
  top: 10px; 
  right: 10px; 
  padding: 8px 16px; 
  background-color: #4A4A4A; 
  color: white; 
  border: none; 
  border-radius: 4px; 
  cursor: pointer;
">Print / Save PDF</button>


<script src="pedigree.js"></script>
  
<script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>

<script>
(function () {
  const svg = document.getElementById('pedigree-svg');
  const container = document.getElementById('pedigree-container');

  function validBox(vb) {
    return vb && isFinite(vb.width) && vb.width > 0 && isFinite(vb.height) && vb.height > 0;
  }

  let panZoom = null;
  let initialized = false;

  function fitToContainer() {
    if (!panZoom) return;
    const vb = svg.viewBox.baseVal;
    if (!validBox(vb)) return;
    const cw = container.clientWidth;
    const ch = container.clientHeight;
    if (!cw || !ch) return;

    const scale = Math.min(cw / vb.width, ch / vb.height);
    if (isFinite(scale) && scale > 0) {
      panZoom.zoom(scale);
      panZoom.pan({
        x: (cw - vb.width * scale) / 2,
        y: (ch - vb.height * scale) / 2
      });
    }
  }

  function tryInit() {
    if (initialized) return;

    // Library blocked by CSP/CDN? Fail loudly once so we know what’s wrong in Glide.
    if (typeof window.svgPanZoom !== 'function') {
      console.error('svg-pan-zoom not loaded. If this only happens inside Glide, host the script yourself or allow this CDN.');
      return;
    }

    const vb = svg.viewBox.baseVal;
    const cw = container.clientWidth;
    const ch = container.clientHeight;
    if (!validBox(vb) || !cw || !ch) return; // wait until non-zero

    panZoom = svgPanZoom(svg, {
      panEnabled: true,
      zoomEnabled: true,
      mouseWheelZoomEnabled: true,
      controlIconsEnabled: false,
      fit: false,
      center: true,
      minZoom: 0.25,
      maxZoom: 10,
      dblClickZoomEnabled: true,
      // smoother in some webviews:
      onUpdatedCTM: function() {} // noop to avoid unnecessary animations
    });
    window.panZoomInstance = panZoom; // ✅ make globally accessible
    fitToContainer();
    enablePointerPan();    
    enablePinchZoom();     
    wirePointerHandlers();  // robust pan & pinch in tricky webviews
    wireWheelZoom();        // desktop wheel-zoom
    initialized = true;
  }

  // Desktop wheel zoom
  function wireWheelZoom() {
    container.addEventListener('wheel', (e) => {
      if (!panZoom) return;
      // zoom around cursor
      const rect = svg.getBoundingClientRect();
      const point = { x: e.clientX - rect.left, y: e.clientY - rect.top };
      const delta = e.deltaY;
      const factor = delta > 0 ? 0.9 : 1.1;
      e.preventDefault();

      if (isFinite(point.x) && isFinite(point.y)) {
        panZoom.zoomAtPoint(factor, point);
      }
    }, { passive: false });
  }
  // === Mouse and single-finger pan ===
  function enablePointerPan() {
    let isPanning = false;
    let start = { x: 0, y: 0 };
    svg.addEventListener("pointerdown", (e) => {
      isPanning = true;
      start = { x: e.clientX, y: e.clientY };
      svg.setPointerCapture(e.pointerId);
    });
    svg.addEventListener("pointermove", (e) => {
      if (!isPanning || !panZoom) return;
      const dx = e.clientX - start.x;
      const dy = e.clientY - start.y;
      panZoom.panBy({ x: dx, y: dy });
      start = { x: e.clientX, y: e.clientY };
    });
    svg.addEventListener("pointerup", () => (isPanning = false));
    svg.addEventListener("pointercancel", () => (isPanning = false));
  }

  // === Two-finger pinch zoom for mobile ===
function enablePinchZoom() {
  let pinchStart = null;
  let startZoom = 1;

  svg.addEventListener(
    "touchstart",
    (e) => {
      if (e.touches.length === 2 && window.panZoomInstance) {
        e.preventDefault();
        const dx = e.touches[0].clientX - e.touches[1].clientX;
        const dy = e.touches[0].clientY - e.touches[1].clientY;
        pinchStart = Math.hypot(dx, dy);
        startZoom = window.panZoomInstance.getZoom();
      }
    },
    { passive: false }
  );

  svg.addEventListener(
    "touchmove",
    (e) => {
      if (e.touches.length === 2 && window.panZoomInstance && pinchStart) {
        e.preventDefault();
        const dx = e.touches[0].clientX - e.touches[1].clientX;
        const dy = e.touches[0].clientY - e.touches[1].clientY;
        const pinchNow = Math.hypot(dx, dy);
        const zoomRatio = pinchNow / pinchStart;

        // Get midpoint between fingers
        const rect = svg.getBoundingClientRect();
        const mid = {
          x: (e.touches[0].clientX + e.touches[1].clientX) / 2 - rect.left,
          y: (e.touches[0].clientY + e.touches[1].clientY) / 2 - rect.top,
        };

        // Apply smooth, relative zoom like Google Maps
        window.panZoomInstance.zoomAtPoint(startZoom * zoomRatio, mid);
      }
    },
    { passive: false }
  );

  svg.addEventListener("touchend", () => {
    pinchStart = null;
  });
}


  // === Refit on resize or visibility changes ===
  const ro = new ResizeObserver(() => {
    if (!initialized) tryInit();
    else fitToContainer();
  });
  ro.observe(container);

  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
      if (!initialized) tryInit();
      else fitToContainer();
    }
  });

  window.addEventListener("load", tryInit);
})();
</script>

  

<script>
  /* === Guaranteed centered & scaled printing using active zoom (DESKTOP) === */
(() => {
  const btn = document.getElementById("print-btn");

  function resetForPrint() {
    const inst = window.panZoomInstance;
    if (!inst) return;

    // Save current zoom/pan so we can restore later
    window._savedState = { pan: inst.getPan(), zoom: inst.getZoom() };

    // Reset to full view, center, and apply perfect print scale
    inst.resetZoom();
    // UPDATED: Adjusted zoom/pan for better full-page fit
    inst.zoom(1.45);
    inst.pan({ x: 100, y: 120 });
  }

  function restoreAfterPrint() {
    const inst = window.panZoomInstance;
    const s = window._savedState;
    if (inst && s) {
      inst.zoom(s.zoom);
      inst.pan(s.pan);
    }
  }

  // Hook into browser print lifecycle
  window.addEventListener("beforeprint", resetForPrint);
  window.addEventListener("afterprint", restoreAfterPrint);

  // Button click handler
  btn.addEventListener("click", () => {
    // Only run this default behavior on non-mobile (mobile handled in the next script block)
    const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
    if (isMobile) return; 

    resetForPrint();
    requestAnimationFrame(() => {
      setTimeout(() => {
        window.print();
        setTimeout(restoreAfterPrint, 800);
      }, 200);
    });
  });
})();
</script>

   
  <script>
      /* === Mobile Print (POPUP WINDOW FIX) === */
(function() {
  const btn = document.getElementById("print-btn");
  if (!btn) return;

  btn.addEventListener("click", (event) => {
    const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
    if (!isMobile) return; // only affects mobile

    event.preventDefault();

    const container = document.getElementById("pedigree-container");
    const inst = window.panZoomInstance;

    if (!container || !inst) return;

    // 1. SAVE the current view state
    const savedState = { pan: inst.getPan(), zoom: inst.getZoom() };

    // 2. APPLY the desired print state
    inst.resetZoom(); 
    // Use the optimized scale/pan values
    inst.zoom(3.20); 
    inst.pan({ x: 15, y: 100 });
    
    // Give the panZoom library a moment to apply the transform to the DOM
    requestAnimationFrame(() => {
        // 3. RETRIEVE the *transformed* SVG markup
        const svgMarkup = container.innerHTML;

        // 4. RESTORE the original view state in the main window *immediately*
        inst.zoom(savedState.zoom);
        inst.pan(savedState.pan);
        
        // Grab all styles from the main document
        const styleBlocks = Array.from(document.querySelectorAll('style'))
          .map(styleEl => styleEl.outerHTML)
          .join('\n');

        const popup = window.open("", "_blank", "width=1200,height=800");
        if (!popup) {
          alert("Please allow pop-ups for ShowTails to print pedigrees.");
          return;
        }
        
        // Write the HTML for the print popup
        popup.document.write(`
          <html>
            <head>
              <title>Print Pedigree</title>
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              ${styleBlocks}
              <style>
                @page { size: landscape; margin: 0; }
                html, body {
                  width: 100%;
                  height: 100%;
                  overflow: hidden;
                  margin: 0;
                  padding: 0;
                  background: white;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                }
                /* New container style to force print area and prevent second page */
                #pedigree-container {
                    width: 11in;
                    height: 8.5in;
                    margin: 0;
                    padding: 0;
                    display: block; 
                    overflow: hidden; 
                }
                svg {
                  width: 10.8in !important;
                  height: 8.3in !important;
                  background: white !important;
                  margin: auto;
                  display: block;
                  /* This style ensures the SVG itself scales to fill the print box */
                  transform: scale(1) translate(0, 0) !important;
                }
              </style>
            </head>
            <body>
              <div id="pedigree-container">${svgMarkup}</div>
            </body>
          </html>
        `);
        popup.document.close();

        // Wait for the SVG to render, then open print dialog
        setTimeout(() => {
          popup.focus();
          popup.print();
          setTimeout(() => popup.close(), 1500);
        }, 600);
    });
  });
})();
</script>

  <script>
const params = new URLSearchParams(window.location.search);

function setSvgImage(id, paramName) {
  const url = params.get(paramName);
  if (!url) return;
  const decoded = decodeURIComponent(url);
  const el = document.getElementById(id);
  if (!el) return;
  // Set both modern and legacy attributes for cross-browser support
  el.setAttribute('href', decoded);
  el.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', decoded);
}

// Load logo and signature
setSvgImage('logo', 'logo');
setSvgImage('signature', 'signature');
</script>



  <script>
// === Glide-safe Clickable Pedigree Boxes ===
document.querySelectorAll('.box').forEach(box => {
  box.style.cursor = 'pointer';
  box.addEventListener('click', () => {
    const slot = box.getAttribute('data-slot');
    if (!slot) return;
    window.parent.postMessage({ pedigreeEdit: slot }, '*');
    box.style.stroke = '#00aaff';
    setTimeout(() => (box.style.stroke = 'black'), 300);
  });
});
</script>
</body>

</html>
